---
title: "Class 9: Candy Mini-Project"
Author: "Melanda Aboueid (PID A17473102)"
format: pdf
toc: true 
---

## Background 

In this mini-project,  you will explore FiveThirtyEight’s Halloween Candy dataset.

We will use lots of **ggplot** some basic stats, correlation analysis and PCA to make sense of the landscape of US candy - something hopefully more relatable than the proteomics and transcriptomics work that we will use these methods on throughout the rest of the course

## Data Import

Our dataset is a CSV file so we use `read.csv()` and have a wee peak with `head

```{r}
candy <- read.csv("candy-data.csv", row.names = 1) 
head(candy)
```

> Q1. How many different candy types are in this dataset?

```{r}
nrow(candy)
```

> Q2. How many fruity candy types are in the dataset?

```{r}
sum(candy$fruity)
```

> Q3. What is your favorite candy (other than Twix) in the dataset and what is it’s winpercent value?

```{r}
candy["Reese's Peanut Butter cup", "winpercent"]
```
My favorite candy is Reese’s Peanut Butter Cup with a winpercent of 84%.

```{r}
library(dplyr)

candy |> 
  filter(row.names(candy)=="Reese's Peanut Butter cup") |> 
  select(winpercent)
```

> Q4. What is the winpercent value for “Kit Kat”?

```{r}
candy["Kit Kat", "winpercent"]
```
Kit Kat has a winpercent of 76%

> Q5. What is the winpercent value for “Tootsie Roll Snack Bars”?

```{r}
candy["Tootsie Roll Snack Bars", "winpercent"]
```
Tootsie Roll Snack Bars have a winpercent of 49%.

> Q6. Is there any variable/column that looks to be on a different scale to the majority of the other columns in the dataset?

Yes! Winpercent, sugarpercent, and pricepercent are on a different scale than the binary variables.

```{r}
library(skimr)
skim(candy)
```


> Q7. What do you think a zero and one represent for the `candy$chocolate` column?

A value of 1 means the candy contains chocolate, and a value of 0 means it does not.

```{r}
library(skimr)
skim(candy$chocolate)
```


## Exploratory analysis

> Q8. Plot a histogram of winpercent values


```{r}
hist(candy$winpercent)
```
```{r}
library(ggplot2)
ggplot(candy) +
aes(winpercent) +
geom_histogram()
```

> Q9. Is the distribution of winpercent values symmetrical?

No, the distribution is not symmetrical. It is slightly skewed.


> Q10. Is the center of the distribution above or below 50%?

```{r}
mean(candy$winpercent)
```
```{r}
summary(candy$winpercent)
```

The center is slightly below 50%.

> Q11. On average is chocolate candy higher or lower ranked than fruit candy?

```{r}
mean(candy$winpercent[candy$chocolate == 1])
```
```{r}
mean(candy$winpercent[candy$fruity == 1])
```
Chocolate candies are ranked higher than fruity candies.
```{r}
choc.candy <-candy[candy$chocolate ==1, ]
choc.win <- choc.candy$winpercent
mean(choc.win)
```

```{r}
fruity.win <- candy[candy$fruity == 1,]$winpercent
mean(fruity.win)
```


> Q12. Is this difference statistically significant?

```{r}

chocolate_rank <- candy$winpercent[as.logical(candy$chocolate)]
candy_rank <- candy$winpercent[as.logical(candy$fruity)]

t.test(x = chocolate_rank, y = candy_rank)

```

It is statistically significant because the t-test shows a p-value below 0.05


## Overall Candy Rankings

> Q13. What are the five least liked candy types in this set?

```{r}
y <- c("y", "a", "z")
sort(y)
```
```{r}
y 
order(y)
```

```{r}
ord.ind <- order(candy$winpercent)
head(candy[ord.ind, ])
```

> Q14. What are the top 5 all time favorite candy types out of this set?

```{r}
tail(candy[ord.ind, ], 5)
```

> Q15. Make a first barplot of candy ranking based on winpercent values.

```{r}
ggplot(candy) + 
  aes(winpercent, 
      reorder(rownames(candy),winpercent)) +
  geom_col() + 
  ylab("")
```

```{r}
ggplot(candy) +
  aes(winpercent,
      reorder(row.names(candy),winpercent),
      fill=chocolate) +
  geom_col() +
  ylab("")
```
> Q16. This is quite ugly, use the reorder() function to get the bars sorted by winpercent?

We need a coustom color vector 
```{r}
my_cols <- rep("black", nrow(candy))
#my_cols[1] <- "red"  first element is red
my_cols[candy$chocolate==1] <- "chocolate"
my_cols[candy$bar==1] <- "darkgreen"
my_cols[candy$fruity==1] <- "hotpink"
my_cols
```

```{r}
ggplot(candy) +
  aes(winpercent,
      reorder(row.names(candy),winpercent)) +
  geom_col(fill=my_cols) +
  ylab("")
```

> Q17. What is the worst ranked chocolate candy?

```{r}
choc <- candy[candy$chocolate == 1, ]

rownames(choc)[which.min(choc$winpercent)]

```
The worst ranked chocolate candy is sixlets

> Q18. What is the best ranked fruity candy?

```{r}
fruit <- candy[candy$fruity == 1, ]

rownames(fruit)[which.max(fruit$winpercent)]

```
The best ranked fruity candy is starburt

## 5 Taking a look at pricepercent

```{r}
library(ggrepel)
# How about a plot of win vs price
ggplot(candy) +
  aes(winpercent, pricepercent, label=rownames(candy)) +
  geom_point(col=my_cols) + 
  geom_text_repel(col=my_cols, size=3.3, max.overlaps = 5)
```

> Q19. Which candy type is the highest ranked in terms of winpercent for the least money - i.e. offers the most bang for your buck?

Reese’s miniatures have high winpercent but low pricepercent

> Q20. What are the top 5 most expensive candy types in the dataset and of these which is the least popular?

Nik L Nip, Nestle Smarties, Ring pop, Hershey’s Krackel, Hershey’s Milk Chocolate are the 5 most expensive and least popular

```{r}
ord <- order(candy$pricepercent, decreasing = TRUE)
head( candy[ord,c(11,12)], n=5 )
```


##Exploring the correlation structure

```{r}
library(corrplot)
```

```{r}
cij <- cor(candy)
corrplot(cij)
```

> Q22. Examining this plot what two variables are anti-correlated (i.e. have minus values)?

Chocolate and fruity are strongly anti-correlated, meaning candies that are chocolate are usually not fruity.

> Q23. Similarly, what two variables are most positively correlated?

Chocolate and bar are the most positively correlated variables because candy bars mostly have chocolate.

## Principal Component Analysis

```{r}
pca <- prcomp(candy, scale=TRUE)
summary(pca)
```
Score Plot...

```{r}
ggplot(pca$x) +
  aes(PC1, PC2, label=row.names(pca$x)) +
  geom_point(col=my_cols)+
  geom_text_repel(max.overlaps = 5, col=my_cols)
```

```{r}
ggplot(pca$rotation) + 
  aes(PC1, 
      reorder(row.names(pca$rotation), PC1)) + 
  geom_col()
```

```{r}
#library(plotly)
#ggplotly(p)
```


> Q24. Complete the code to generate the loadings plot above. What original variables are picked up strongly by PC1 in the positive direction? Do these make sense to you? Where did you see this relationship highlighted previously?

PC1 is driven by fruity and hard candies and negatively by chocolate and bar candies. this makes sense because chocolate and fruit were negative before.

> Q25. Based on your exploratory analysis, correlation findings, and PCA results, what combination of characteristics appears to make a “winning” candy? How do these different analyses (visualization, correlation, PCA) support or complement each other in reaching this conclusion?

Winning candies are mostly chocolate-based or bars because they have higher win percent values and positive correlations between them, and the PCA separating chocolate candies from the less popular fruity types.
